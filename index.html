<script>
// ビンゴ達成時の処理に追加
function checkBingo() {
  const savedStamps = JSON.parse(localStorage.getItem('stamps')) || [];
  const bingoPatterns = [
    [1,2,3],[4,5,6],[7,8,9],
    [1,4,7],[2,5,8],[3,6,9],
    [1,5,9],[3,5,7]
  ];
  for (let pattern of bingoPatterns) {
    if (pattern.every(num => savedStamps.includes('stamp' + num))) {
      document.getElementById('complete-screen').style.display = 'block';
      document.getElementById('complete-screen').scrollIntoView({ behavior: 'smooth' });
      playFanfare();
      launchConfetti(); // ← クラッカー演出追加
      break;
    }
  }
}

// クラッカー音と紙吹雪
function launchConfetti() {
  // 音を再生
  document.getElementById('cracker-sound').play();

  // 紙吹雪アニメーション
  const duration = 3000;
  const end = Date.now() + duration;

  (function frame() {
    // confetti.jsを使わない簡易版
    const colors = ['#ff0', '#f00', '#0f0', '#00f', '#ff69b4', '#ffa500'];
    for (let i = 0; i < 10; i++) {
      const confetti = document.createElement('div');
      confetti.style.position = 'fixed';
      confetti.style.top = '-10px';
      confetti.style.left = Math.random() * window.innerWidth + 'px';
      confetti.style.width = '8px';
      confetti.style.height = '14px';
      confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
      confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
      confetti.style.zIndex = '9999';
      document.body.appendChild(confetti);

      // 落下アニメーション
      const fallDuration = 3000;
      const start = Date.now();
      (function drop() {
        const progress = (Date.now() - start) / fallDuration;
        confetti.style.top = progress * window.innerHeight + 'px';
        if (progress < 1) {
          requestAnimationFrame(drop);
        } else {
          confetti.remove();
        }
      })();
    }
    if (Date.now() < end) {
      requestAnimationFrame(frame);
    }
  })();
}
</script>
