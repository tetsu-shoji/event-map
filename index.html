
<!-- å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<script>
const video = document.getElementById('camera');
const statusText = document.getElementById('status');
let sent = false;

async function initLIFF() {
  await liff.init({ liffId: "YOUR_LIFF_ID" });
  if (!liff.isLoggedIn()) liff.login();
}
initLIFF();

navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
  video.srcObject = stream;
});

const hands = new Hands({ locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` });
hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.7, minTrackingConfidence: 0.7 });
hands.onResults(results => {
  if (results.multiHandLandmarks.length > 0 && !sent) {
    const landmarks = results.multiHandLandmarks[0];
    console.log("ãƒ©ãƒ³ãƒ‰ãƒžãƒ¼ã‚¯:", landmarks); // ãƒ‡ãƒãƒƒã‚°ç”¨
    if (checkPeaceSign(landmarks)) {
      sendPeaceMessage();
    }
  }
});

const camera = new Camera(video, {
  onFrame: async () => { await hands.send({ image: video }); },
  width: 300, height: 300
});
camera.start();

function checkPeaceSign(landmarks) {
  const indexUp = landmarks[8].y < landmarks[6].y;
  const middleUp = landmarks[12].y < landmarks[10].y;
  return indexUp && middleUp; // æ¡ä»¶ã‚’ç·©ã‚ã‚‹
}

async function sendPeaceMessage() {
  statusText.textContent = "ðŸ“¸ ãƒ”ãƒ¼ã‚¹æ¤œå‡º â†’ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ä¸­...";
  sent = true;
  try {
    await liff.sendMessages([{ type: "text", text: "ãƒ”ãƒ¼ã‚¹" }]);
    statusText.textContent = "âœ… LINEã«ã€Œãƒ”ãƒ¼ã‚¹ã€ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼";
  } catch (err) {
    statusText.textContent = "âŒ é€ä¿¡ã‚¨ãƒ©ãƒ¼: " + err;
  }
}
</script>
