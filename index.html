<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¸ã‚§ã‚¤ã‚¢ãƒ¼ãƒ«æ±æ—¥æœ¬éƒ½å¸‚é–‹ç™º ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: 'Segoe UI', sans-serif; background: #f4f6f8; margin: 10px; color: #333; }
  h1 { font-size: 1.8em; color: #2e7d32; text-align: center; }
  h2 { font-size: 1.3em; color: #34495e; text-align: center; }
  .stamp-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px; }
  .stamp-cell { width: 100%; padding-top: 100%; position: relative; background: #fff; border: 2px solid #ccc; }
  .stamp-cell span { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
  .stamp-mark { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: 70%; background-repeat: no-repeat; background-position: center; opacity: 0.9; }
  #map { width: 100%; height: 250px; margin-top: 20px; border-radius: 8px; }
  #qr-reader { width: 90%; max-width: 350px; margin: 15px auto; display: none; }
  .btn-container { text-align: center; margin-bottom: 15px; }
  button { padding: 12px 20px; margin: 5px; background-color: #2e7d32; color: white; border: none; border-radius: 6px; font-size: 1em; cursor: pointer; width: 45%; }
  button:hover { background-color: #1b5e20; }
  #complete-screen { display: none; text-align: center; padding: 15px; background: #e8f5e9; border-radius: 8px; }
  .form-btn { display: inline-block; padding: 12px 20px; background-color: #0078D7; color: white; text-decoration: none; border-radius: 6px; font-size: 1.1em; margin-top: 10px; }
  .form-btn:hover { background-color: #005a9e; }
  #line-warning { display: none; text-align: center; background: #fff3cd; color: #856404; padding: 10px; margin-bottom: 15px; border-radius: 6px; font-size: 1em; }
</style>
</head>
<body>

<h1>ãˆ±ã‚¸ã‚§ã‚¤ã‚¢ãƒ¼ãƒ«æ±æ—¥æœ¬éƒ½å¸‚é–‹ç™º ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</h1>

<!-- LINEè­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
<div id="line-warning">
  LINEã‚¢ãƒ—ãƒªå†…ã§ã¯ã‚«ãƒ¡ãƒ©ãŒèµ·å‹•ã§ãã¾ã›ã‚“ã€‚<br>
  ä¸‹ã®ãƒœã‚¿ãƒ³ã‹ã‚‰å¤–éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆSafari/Chromeï¼‰ã§é–‹ã„ã¦ãã ã•ã„ã€‚
  https://ã‚ãªãŸã®ãƒšãƒ¼ã‚¸URLå¤–éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã</a>
</div>

<h2>ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</h2>
<div class="stamp-container" id="stampContainer"></div>

<div class="btn-container">
  <button id="start-scan-btn">QRèª­ã¿è¾¼ã¿é–‹å§‹</button>
  <button id="stop-scan-btn" disabled>åœæ­¢</button>
  <button id="reset-btn" style="background-color:#d9534f;">å…¨å‰Šé™¤</button>
</div>

<div id="qr-reader"></div>

<div id="complete-screen">
  <h2>ğŸ‰ ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ ğŸ‰</h2>
  <p>å—ä»˜ã§æ™¯å“ã‚’å—ã‘å–ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚</p>
  https://forms.office.com/r/sn3wvtS6Yyå¿œå‹Ÿãƒ•ã‚©ãƒ¼ãƒ ã¸</a>
  <p>â€»é€ä¿¡å¾Œã€ã“ã®ç”»é¢ã‚’å—ä»˜ã§æç¤ºã—ã¦ãã ã•ã„ã€‚</p>
</div>

<div id="map"></div>

<!-- QRã‚³ãƒ¼ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
https://unpkg.com/html5-qrcode</script>

<script>
  // LINEãƒ–ãƒ©ã‚¦ã‚¶æ¤œå‡º
  if (navigator.userAgent.includes("Line")) {
    document.getElementById('line-warning').style.display = 'block';
  }

  const stampImages = [
    'https://cdn-icons-png.flaticon.com/512/616/616408.png',
    'https://cdn-icons-png.flaticon.com/512/616/616430.png',
    'https://cdn-icons-png.flaticon.com/512/616/616426.png',
    'https://cdn-icons-png.flaticon.com/512/616/616439.png',
    'https://cdn-icons-png.flaticon.com/512/616/616443.png',
    'https://cdn-icons-png.flaticon.com/512/616/616445.png',
    'https://cdn-icons-png.flaticon.com/512/616/616447.png',
    'https://cdn-icons-png.flaticon.com/512/616/616449.png',
    'https://cdn-icons-png.flaticon.com/512/616/616451.png'
  ];

  function initMap() {
    const mapCenter = { lat: 35.659466436461635, lng: 139.8171347921082 };
    const map = new google.maps.Map(document.getElementById("map"), { zoom: 18, center: mapCenter });
    new google.maps.Marker({ position: mapCenter, map: map, title: "æ½®è¦‹é«˜æ¶ä¸‹" });
  }

  const container = document.getElementById('stampContainer');
  const savedStamps = JSON.parse(localStorage.getItem('stamps')) || [];
  for (let i = 1; i <= 9; i++) {
    const cell = document.createElement('div');
    cell.className = 'stamp-cell';
    const label = document.createElement('span');
    label.textContent = 'B' + i;
    cell.appendChild(label);
    if (savedStamps.includes('B' + i)) {
      const stamp = document.createElement('div');
      stamp.className = 'stamp-mark';
      stamp.style.backgroundImage = `url(${stampImages[i-1]})`;
      cell.appendChild(stamp);
    }
    container.appendChild(cell);
  }

  let qrReader;

  document.getElementById('start-scan-btn').addEventListener('click', () => {
    document.getElementById('qr-reader').style.display = 'block';
    document.getElementById('stop-scan-btn').disabled = false;
    if (!qrReader) {
      qrReader = new Html5Qrcode("qr-reader");
    }
    qrReader.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: 250 },
      qrCodeMessage => {
        if (/^B[1-9]$/.test(qrCodeMessage)) {
          const index = parseInt(qrCodeMessage.replace('B','')) - 1;
          const cells = document.querySelectorAll('.stamp-cell');
          cells.forEach(cell => {
            if (cell.textContent.includes(qrCodeMessage) && !cell.querySelector('.stamp-mark')) {
              const stamp = document.createElement('div');
              stamp.className = 'stamp-mark';
              stamp.style.backgroundImage = `url(${stampImages[index]})`;
              cell.appendChild(stamp);
              savedStamps.push(qrCodeMessage);
              localStorage.setItem('stamps', JSON.stringify(savedStamps));
            }
          });
          checkCompletion();
        }
      },
      errorMessage => console.warn(`èª­ã¿å–ã‚Šã‚¨ãƒ©ãƒ¼: ${errorMessage}`)
    ).catch(err => alert('ã‚«ãƒ¡ãƒ©èµ·å‹•ã‚¨ãƒ©ãƒ¼: ' + err));
  });

  document.getElementById('stop-scan-btn').addEventListener('click', () => {
    if (qrReader) {
      qrReader.stop().then(() => {
        alert('QRèª­ã¿å–ã‚Šã‚’åœæ­¢ã—ã¾ã—ãŸ');
        document.getElementById('stop-scan-btn').disabled = true;
      });
    }
  });

  document.getElementById('reset-btn').addEventListener('click', () => {
    localStorage.removeItem('stamps');
    alert('ã‚¹ã‚¿ãƒ³ãƒ—ã‚’å…¨å‰Šé™¤ã—ã¾ã—ãŸ');
    location.reload();
  });

  function checkCompletion() {
    if (savedStamps.length === 9) {
      document.getElementById('complete-screen').style.display = 'block';
      if (qrReader) qrReader.stop();
      document.getElementById('stop-scan-btn').disabled = true;
    }
  }
  checkCompletion();
</script>

<!-- Google Maps API -->
https://maps.googleapis.com/maps/api/js?key=AIzaSyA4oFb8iNj2R_2lzlvpSZgOZiets5j2psg&callback=initMap</script>
</body>
