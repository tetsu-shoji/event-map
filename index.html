
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒ”ãƒ¼ã‚¹ã‚µã‚¤ãƒ³ã§è‡ªå‹•æ’®å½±ï¼†LINEé€ä¿¡</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: 'Segoe UI', sans-serif; text-align: center; background: #f0f4f8; }
  video { width: 300px; border-radius: 8px; margin-top: 10px; }
  #snapshot { display: none; }
  #status { margin-top: 10px; font-weight: bold; color: #333; }
</style>
</head>
<body>
<h1>ãƒ”ãƒ¼ã‚¹ã‚µã‚¤ãƒ³ã§è‡ªå‹•æ’®å½±ï¼†LINEé€ä¿¡</h1>
<video id="camera" autoplay playsinline></video>
<canvas id="snapshot"></canvas>
<p id="status">ã‚«ãƒ¡ãƒ©èµ·å‹•ä¸­...</p>

<!-- MediaPipe & LIFF SDK -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<script>
const video = document.getElementById('camera');
const canvas = document.getElementById('snapshot');
const ctx = canvas.getContext('2d');
const statusText = document.getElementById('status');
let capturedImage = null;
let sent = false; // äºŒé‡é€ä¿¡é˜²æ­¢

// âœ… LIFFåˆæœŸåŒ–
async function initLIFF() {
  await liff.init({ liffId: "YOUR_LIFF_ID" }); // â†ã“ã“ã«æ—¢å­˜ã®LIFF IDã‚’è¨­å®š
  if (!liff.isLoggedIn()) {
    liff.login();
  }
}
initLIFF();

// âœ… ã‚«ãƒ¡ãƒ©èµ·å‹•
navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
  video.srcObject = stream;
});

// âœ… MediaPipe Handsè¨­å®š
const hands = new Hands({ locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` });
hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.7, minTrackingConfidence: 0.7 });
hands.onResults(results => {
  if (results.multiHandLandmarks.length > 0 && !sent) {
    const landmarks = results.multiHandLandmarks[0];
    if (checkPeaceSign(landmarks)) {
      takePhotoAndSend();
    }
  }
});

const camera = new Camera(video, {
  onFrame: async () => { await hands.send({ image: video }); },
  width: 300, height: 300
});
camera.start();

// âœ… ãƒ”ãƒ¼ã‚¹ã‚µã‚¤ãƒ³åˆ¤å®š
function checkPeaceSign(landmarks) {
  const indexUp = landmarks[8].y < landmarks[6].y;
  const middleUp = landmarks[12].y < landmarks[10].y;
  const ringDown = landmarks[16].y > landmarks[14].y;
  const pinkyDown = landmarks[20].y > landmarks[18].y;
  return indexUp && middleUp && ringDown && pinkyDown;
}

// âœ… æ’®å½±ï¼‹LINEé€ä¿¡
async function takePhotoAndSend() {
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video, 0, 0);
  capturedImage = canvas.toDataURL('image/png');
  statusText.textContent = "ğŸ“¸ ãƒ”ãƒ¼ã‚¹ã‚µã‚¤ãƒ³æ¤œå‡º â†’ æ’®å½±ï¼†é€ä¿¡ä¸­...";
  sent = true;

  try {
    await liff.sendMessages([{
      type: "image",
      originalContentUrl: capturedImage,
      previewImageUrl: capturedImage
    }]);
    statusText.textContent = "âœ… LINEã«ç”»åƒã‚’é€ä¿¡ã—ã¾ã—ãŸï¼";
  } catch (err) {
    statusText.textContent = "âŒ é€ä¿¡ã‚¨ãƒ©ãƒ¼: " + err;
  }
}
</script>
</body>
</html>
