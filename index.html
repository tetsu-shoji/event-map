
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒ”ãƒ¼ã‚¹ã‚µã‚¤ãƒ³ã§LINEé€ä¿¡</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: 'Segoe UI', sans-serif; text-align: center; background: #f0f4f8; }
  video { width: 300px; border-radius: 8px; margin-top: 10px; }
  #status { margin-top: 10px; font-weight: bold; color: #333; }
</style>
</head>
<body>
<h1>ãƒ”ãƒ¼ã‚¹ã‚µã‚¤ãƒ³ã§ã€Œãƒ”ãƒ¼ã‚¹ã€é€ä¿¡</h1>
<video id="camera" autoplay playsinline></video>
<p id="status">ã‚«ãƒ¡ãƒ©èµ·å‹•ä¸­...</p>

<!-- å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<script>
const video = document.getElementById('camera');
const statusText = document.getElementById('status');
let sent = false; // äºŒé‡é€ä¿¡é˜²æ­¢

// âœ… LIFFåˆæœŸåŒ–ï¼‹æ¨©é™ä»˜ããƒ­ã‚°ã‚¤ãƒ³
async function initLIFF() {
  try {
    await liff.init({ liffId: "YOUR_LIFF_ID" }); // â†ã“ã“ã«æ—¢å­˜ã®LIFF IDã‚’è¨­å®š
    if (!liff.isLoggedIn()) {
      liff.login({ scope: ['chat_message.write'] }); // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æ¨©é™ã‚’è¦æ±‚
    }
    console.log("LIFFåˆæœŸåŒ–æˆåŠŸ");
  } catch (err) {
    statusText.textContent = "âŒ LIFFåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: " + err.message;
  }
}
initLIFF();

// âœ… ã‚«ãƒ¡ãƒ©èµ·å‹•ï¼ˆã‚¨ãƒ©ãƒ¼å‡¦ç†ä»˜ãï¼‰
async function startCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    video.srcObject = stream;
    statusText.textContent = "âœ… ã‚«ãƒ¡ãƒ©èµ·å‹•æˆåŠŸ";
  } catch (err) {
    console.error("ã‚«ãƒ¡ãƒ©èµ·å‹•ã‚¨ãƒ©ãƒ¼:", err);
    statusText.textContent = "âŒ ã‚«ãƒ¡ãƒ©èµ·å‹•ã‚¨ãƒ©ãƒ¼: " + err.message + "ï¼ˆHTTPSã¨æ¨©é™ã‚’ç¢ºèªï¼‰";
  }
}
startCamera();

// âœ… MediaPipe Handsè¨­å®š
const hands = new Hands({ locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` });
hands.setOptions({
  maxNumHands: 1,
  modelComplexity: 1,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.7
});
hands.onResults(results => {
  if (results.multiHandLandmarks.length > 0 && !sent) {
    const landmarks = results.multiHandLandmarks[0];
    console.log("ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯:", landmarks); // ãƒ‡ãƒãƒƒã‚°ç”¨
    if (checkPeaceSign(landmarks)) {
      sendPeaceMessage();
    }
  }
});

// âœ… ã‚«ãƒ¡ãƒ©æ˜ åƒã‚’MediaPipeã«æ¸¡ã™
const camera = new Camera(video, {
  onFrame: async () => {
    await hands.send({ image: video });
  },
  width: 300,
  height: 300
});
camera.start();

// âœ… ãƒ”ãƒ¼ã‚¹ã‚µã‚¤ãƒ³åˆ¤å®šï¼ˆæ¡ä»¶ã‚’ç·©ã‚ã‚‹ï¼‰
function checkPeaceSign(landmarks) {
  const indexUp = landmarks[8].y < landmarks[6].y;
  const middleUp = landmarks[12].y < landmarks[10].y;
  return indexUp && middleUp; // äººå·®ã—æŒ‡ã¨ä¸­æŒ‡ãŒä¸ŠãŒã£ã¦ã„ã‚Œã°OK
}

// âœ… ã€Œãƒ”ãƒ¼ã‚¹ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
async function sendPeaceMessage() {
  statusText.textContent = "ğŸ“¸ ãƒ”ãƒ¼ã‚¹æ¤œå‡º â†’ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ä¸­...";
  sent = true;
  try {
    await liff.sendMessages([{ type: "text", text: "ãƒ”ãƒ¼ã‚¹" }]);
    statusText.textContent = "âœ… LINEã«ã€Œãƒ”ãƒ¼ã‚¹ã€ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼";
  } catch (err) {
    statusText.textContent = "âŒ é€ä¿¡ã‚¨ãƒ©ãƒ¼: " + err.message;
  }
}
</script>
</body>
</html>
