<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¸ã‚§ã‚¤ã‚¢ãƒ¼ãƒ«æ±æ—¥æœ¬éƒ½å¸‚é–‹ç™º ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #f4f6f8;
    margin: 20px;
    color: #333;
  }
  h1 { font-size: 2em; color: #2e7d32; margin-bottom: 0.5em; }
  h2 { font-size: 1.4em; color: #34495e; margin-bottom: 1em; }
  #map {
    width: 100%; height: 300px; margin-bottom: 20px;
    border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  .stamp-container {
    display: grid; grid-template-columns: repeat(3, 100px);
    gap: 10px; justify-content: center; margin-bottom: 20px;
  }
  .stamp-cell {
    width: 100px; height: 100px; background: #fff; border: 2px solid #ccc;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.2em; position: relative;
  }
  .stamp-mark {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: url('https://cdn-icons-png.flaticon.com/512/190/190411.png') center/60% no-repeat;
    opacity: 0.8;
  }
  #qr-reader {
    width: 300px; margin: 0 auto; display: none;
  }
  #complete-screen {
    display: none; text-align: center; padding: 20px; background: #e8f5e9;
    border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  .form-group {
    margin-bottom: 10px;
  }
  input, textarea {
    width: 90%; padding: 8px; font-size: 1em; border: 1px solid #ccc; border-radius: 4px;
  }
  button {
    padding: 10px 20px; background-color: #2e7d32; color: white; border: none;
    border-radius: 6px; font-size: 1em; cursor: pointer;
  }
  button:hover { background-color: #1b5e20; }
</style>
</head>
<body>

<h1>ãˆ±ã‚¸ã‚§ã‚¤ã‚¢ãƒ¼ãƒ«æ±æ—¥æœ¬éƒ½å¸‚é–‹ç™º ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</h1>
<div id="map"></div>

<h2>ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</h2>
<div class="stamp-container" id="stampContainer"></div>

<div id="qr-reader"></div>

<div id="complete-screen">
  <h2>ğŸ‰ ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ ğŸ‰</h2>
  <p>ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›ã—ã¦å¿œå‹Ÿã—ã¦ãã ã•ã„ã€‚</p>
  <form id="entry-form">
    <div class="form-group">
      <input type="text" id="name" placeholder="ãŠåå‰" required>
    </div>
    <div class="form-group">
      <input type="email" id="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" required>
    </div>
    <div class="form-group">
      <textarea id="comment" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆä»»æ„ï¼‰"></textarea>
    </div>
    <button type="submit">å¿œå‹Ÿã™ã‚‹</button>
  </form>
</div>

<!-- ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
<script src="https://unpkg.com/html5-qrcode"></script>
<script>
  // Google MapåˆæœŸåŒ–
  function initMap() {
    const mapCenter = { lat: 35.659466436461635, lng: 139.8171347921082 };
    const map = new google.maps.Map(document.getElementById("map"), { zoom: 18, center: mapCenter });
    const marker = new google.maps.Marker({ position: mapCenter, map: map, title: "æ½®è¦‹é«˜æ¶ä¸‹" });
  }

  // ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼ç”Ÿæˆ
  const container = document.getElementById('stampContainer');
  const savedStamps = JSON.parse(localStorage.getItem('stamps')) || [];
  for (let i = 1; i <= 9; i++) {
    const cell = document.createElement('div');
    cell.className = 'stamp-cell';
    cell.textContent = 'B' + i;
    if (savedStamps.includes('B' + i)) {
      const stamp = document.createElement('div');
      stamp.className = 'stamp-mark';
      cell.appendChild(stamp);
    }
    container.appendChild(cell);
  }

  // QRã‚³ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€ãƒ¼èµ·å‹•
  document.getElementById('qr-reader').style.display = 'block';
  const qrReader = new Html5Qrcode("qr-reader");

  qrReader.start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 250 },
    qrCodeMessage => {
      if (/^B[1-9]$/.test(qrCodeMessage)) {
        const cells = document.querySelectorAll('.stamp-cell');
        cells.forEach(cell => {
          if (cell.textContent === qrCodeMessage && !cell.querySelector('.stamp-mark')) {
            const stamp = document.createElement('div');
            stamp.className = 'stamp-mark';
            cell.appendChild(stamp);
            savedStamps.push(qrCodeMessage);
            localStorage.setItem('stamps', JSON.stringify(savedStamps));
          }
        });
        checkCompletion();
      }
    },
    errorMessage => console.warn(`èª­ã¿å–ã‚Šã‚¨ãƒ©ãƒ¼: ${errorMessage}`)
  ).catch(err => alert('ã‚«ãƒ¡ãƒ©èµ·å‹•ã‚¨ãƒ©ãƒ¼: ' + err));

  // ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆåˆ¤å®š
  function checkCompletion() {
    if (savedStamps.length === 9) {
      document.getElementById('complete-screen').style.display = 'block';
      qrReader.stop(); // ã‚¹ã‚­ãƒ£ãƒ³åœæ­¢
    }
  }
  checkCompletion(); // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚‚ç¢ºèª

  // å¿œå‹Ÿãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
  document.getElementById('entry-form').addEventListener('submit', e => {
    e.preventDefault();
    alert('å¿œå‹ŸãŒå®Œäº†ã—ã¾ã—ãŸï¼\nãŠåå‰: ' + document.getElementById('name').value);
    localStorage.removeItem('stamps'); // å¿œå‹Ÿå¾Œã«ãƒªã‚»ãƒƒãƒˆ
    location.reload();
  });
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA4oFb8iNj2R_2lzlvpSZgOZiets5j2psg&callback=initMap" async defer></script>
</body>
</html>
